<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FLIGHT‑LOGBOOK — บันทึกเที่ยวบิน</title>
  <meta name="description" content="หน้าบันทึกเที่ยวบินสำหรับ Flight Logbook" />
  <style>
    :root{
      --bg1:#0f172a; --bg2:#1e293b; --text:#e5e7eb; --muted:#9aa4b2;
      --card:#0b1223bf; --accent:#6366f1; --accent2:#22d3ee; --ok:#16a34a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, #1f2937 0%, transparent 50%),
                  radial-gradient(900px 600px at 120% 10%, #0ea5e9 0%, transparent 40%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
    }
    .wrap{ width:min(1100px, 94vw); margin:32px auto; padding:12px; }

    .card{ position:relative; border:1px solid #1f2937; border-radius:24px; padding:24px; background:linear-gradient(180deg, #0b1223cc, #0b122380); backdrop-filter: blur(10px); box-shadow:0 20px 60px rgb(0 0 0 / 45%); }
    h1{ margin:0 0 10px; font-size:clamp(24px, 4vw, 36px); font-weight:800; letter-spacing:.3px; display:flex; align-items:center; gap:10px; }
    .logo{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg, #4f46e5, #22d3ee); box-shadow:inset 0 0 20px #ffffff22; }
    .logo svg{ width:24px; height:24px; color:white; }
    .tag{ color:var(--muted) }

    .grid{ display:grid; gap:16px; grid-template-columns: 1fr; margin-top:18px; }
    @media (min-width:900px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .panel{ border:1px solid #1f2937; border-radius:18px; padding:18px; background:#0b122355; }
    .panel h2{ margin:0 0 12px; font-size:18px; color:#c7d2fe; }

    .field{ margin-bottom:12px; }
    .field label{ display:block; font-size:14px; color:#cbd5e1; margin-bottom:6px; }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    input, select{ width:100%; padding:12px 12px; border-radius:12px; border:1px solid #334155; background:#0f172a; color:#e5e7eb; outline:none; }
    input:focus, select:focus{ border-color:#64748b; }

    .actions{ grid-column:1 / -1; display:flex; gap:10px; }
    .btn{ appearance:none; border:none; cursor:pointer; padding:14px 16px; border-radius:14px; font-weight:800; }
    .btn-primary{ background:linear-gradient(90deg, #22c55e, #16a34a); color:white; }
    .btn-secondary{ background:#111827; color:#e5e7eb; border:1px solid #334155; }

    .toast{ position:fixed; right:16px; bottom:16px; padding:12px 14px; border-radius:12px; background:#111827; border:1px solid #374151; color:#e5e7eb; box-shadow:0 10px 30px #00000040; opacity:0; transform: translateY(6px); transition: all .2s ease; }
    .toast.show{ opacity:1; transform: translateY(0); }
  </style>
<style>
  /* Page loader for transitions */
  .page-loader{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; background:radial-gradient(600px 360px at 30% 10%, #1f2937aa 0%, transparent 60%), rgba(2,6,23,.72); backdrop-filter: blur(6px); }
  .page-loader.show{ display:flex; }
  .loader-card{ width:min(420px,92vw); border:1px solid #1f2937; border-radius:16px; background:#0b1223cc; padding:18px; box-shadow:0 20px 60px #0008; }
  .loader-row{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
  .loader-logo{ width:46px; height:46px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg,#4f46e5,#22d3ee); box-shadow:inset 0 0 18px #ffffff22; }
  .loader-logo svg{ width:24px; height:24px; color:white; }
  .tube{ position:relative; height:12px; border-radius:999px; overflow:hidden; background:#0f172a; border:1px solid #334155; }
  .tube .fill{ position:absolute; inset:0 auto 0 0; width:100%; transform:translateX(-100%); background:linear-gradient(90deg,#22d3ee,#6366f1,#22c55e); animation:fillRun 2.2s ease-in-out infinite; }
  .tube .plane{ position:absolute; top:-14px; left:0; width:32px; height:32px; animation:planeRun 2.2s ease-in-out infinite; }
  @keyframes fillRun{ 0%{ transform:translateX(-100%) } 100%{ transform:translateX(0) } }
  @keyframes planeRun{ 0%{ transform:translateX(0) } 100%{ transform:translateX(calc(100% - 32px)) } }
</style>
<style>
  /* Page transition loader */
  .page-loader{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; background:radial-gradient(600px 360px at 30% 10%, #1f2937aa 0%, transparent 60%), rgba(2,6,23,.72); backdrop-filter: blur(6px); }
  .page-loader.show{ display:flex; }
  .loader-card{ width:min(420px,92vw); border:1px solid #1f2937; border-radius:16px; background:#0b1223cc; padding:18px; box-shadow:0 20px 60px #0008; }
  .loader-row{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
  .loader-logo{ width:46px; height:46px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg,#4f46e5,#22d3ee); box-shadow:inset 0 0 18px #ffffff22; }
  .loader-logo svg{ width:24px; height:24px; color:white; }
  .tube{ position:relative; height:12px; border-radius:999px; overflow:hidden; background:#0f172a; border:1px solid #334155; }
  .tube .fill{ position:absolute; inset:0 auto 0 0; width:100%; transform:translateX(-100%); background:linear-gradient(90deg,#22d3ee,#6366f1,#22c55e); animation:fillRun 2.2s ease-in-out infinite; }
  .tube .plane{ position:absolute; top:-14px; left:0; width:32px; height:32px; animation:planeRun 2.2s ease-in-out infinite; }
  @keyframes fillRun{ 0%{ transform:translateX(-100%) } 100%{ transform:translateX(0) } }
  @keyframes planeRun{ 0%{ transform:translateX(0) } 100%{ transform:translateX(calc(100% - 32px)) } }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div style="display:flex; align-items:center; gap:12px;">
          <div class="logo" aria-hidden="true">
            <!-- Paper airplane icon -->
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
          </div>
          <div>
            <h1>FLIGHT‑LOGBOOK</h1>
            <div class="tag">หน้าที่ 2 — บันทึกเที่ยวบิน</div>
          </div>
        </div>
        <button id="signOutBtn" class="btn btn-secondary" type="button">ออกจากระบบ</button>
      </div>

      <form id="flightForm" class="grid" autocomplete="off">
        <!-- Panel 1: Flight Information -->
        <div class="panel">
          <h2>ข้อมูลเที่ยวบิน (Flight Information)</h2>

          <div class="field">
            <label for="flightDateTime">วันที่และเวลาที่ทำการบิน</label>
            <input id="flightDateTime" type="datetime-local" required />
          </div>

          <div class="row">
            <div class="field">
              <label for="flightNumber">หมายเลขเที่ยวบิน (Flight Number)</label>
              <input id="flightNumber" type="text" placeholder="เช่น TG102, FD1234" required />
            </div>
            <div class="field">
              <label for="airline">สายการบิน</label>
              <input id="airline" type="text" placeholder="เช่น Thai Airways" required />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="origin">ต้นทาง (Origin)</label>
              <input id="origin" type="text" placeholder="เช่น BKK — Suvarnabhumi" required />
            </div>
            <div class="field">
              <label for="destination">ปลายทาง (Destination)</label>
              <input id="destination" type="text" placeholder="เช่น CNX — Chiang Mai" required />
            </div>
          </div>
        </div>

        <!-- Panel 2: Aircraft Information -->
        <div class="panel">
          <h2>ข้อมูลเครื่องบิน (Aircraft Information)</h2>

          <div class="field">
            <label for="aircraftModel">รุ่นของเครื่องบิน (Aircraft Model)</label>
            <input id="aircraftModel" type="text" placeholder="เช่น A320, B737-800" required />
          </div>

          <div class="field">
            <label for="registration">เครื่องหมายทะเบียน (Registration Number)</label>
            <input id="registration" type="text" placeholder="เช่น HS-TJA" required />
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" type="submit">บันทึกเที่ยวบิน</button>
          <button class="btn btn-secondary" type="reset">ล้างฟอร์ม</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Firebase (Auth Guard) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-mqfAKi-qWowUgJXph-Z7qn9KQX31CbE",
      authDomain: "flight-logbook-50b3a.firebaseapp.com",
      projectId: "flight-logbook-50b3a",
      storageBucket: "flight-logbook-50b3a.appspot.com",
      messagingSenderId: "1022124291344"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const qs = (s)=>document.querySelector(s);
    const toastEl = qs('#toast');
    const showLoader = (flag)=>{ document.getElementById('pageLoader')?.classList.toggle('show', !!flag); };
    const toast = (msg)=>{ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 2200); };

    onAuthStateChanged(auth, (user)=>{
      if(!user){
        // ไม่ได้ล็อกอิน → เด้งกลับหน้าแรก
        window.location.href = '/';
      }
    });

    // (ชั่วคราว) เก็บข้อมูลใน localStorage — ภายหลังสามารถเปลี่ยนเป็น Firestore ได้
    const form = qs('#flightForm');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = {
        dateTime: qs('#flightDateTime').value,
        flightNumber: qs('#flightNumber').value.trim(),
        airline: qs('#airline').value.trim(),
        origin: qs('#origin').value.trim(),
        destination: qs('#destination').value.trim(),
        aircraftModel: qs('#aircraftModel').value.trim(),
        registration: qs('#registration').value.trim()
      };
      try{
        const key = 'flb_entries';
        const all = JSON.parse(localStorage.getItem(key) || '[]');
        all.push({ ...data, createdAt: Date.now() });
        localStorage.setItem(key, JSON.stringify(all));
        toast('บันทึกเที่ยวบินแล้ว');
        form.reset();
      }catch(err){
        console.error(err);
        toast('บันทึกไม่สำเร็จ');
      }
    });

    // sign out
    qs('#signOutBtn')?.addEventListener('click', async ()=>{
      try{ await signOut(auth); } catch{} finally{ window.location.href = '/'; }
    });
  </script>
  <!-- Loader overlay (visible by default until auth resolves) -->
  <div id="pageLoader" class="page-loader show" role="status" aria-live="polite" aria-label="กำลังโหลด">
    <div class="loader-card">
      <div class="loader-row">
        <div class="loader-logo" aria-hidden="true">
          <!-- Paper airplane icon -->
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </div>
        <div>
          <div style="font-weight:800; letter-spacing:.3px">กำลังโหลดหน้า…</div>
          <div style="color:#9aa4b2; font-size:13px">โปรดรอสักครู่</div>
        </div>
      </div>
      <div class="tube">
        <div class="fill"></div>
        <svg class="plane" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </div>
    </div>
  </div>
  <!-- Page transition loader overlay -->
  <div id="pageLoader" class="page-loader" role="status" aria-live="polite" aria-label="กำลังโหลด">
    <div class="loader-card">
      <div class="loader-row">
        <div class="loader-logo" aria-hidden="true">
          <!-- Paper airplane icon -->
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </div>
        <div>
          <div style="font-weight:800; letter-spacing:.3px">กำลังเปลี่ยนหน้า…</div>
          <div style="color:#9aa4b2; font-size:13px">โปรดรอสักครู่</div>
        </div>
      </div>
      <div class="tube">
        <div class="fill"></div>
        <svg class="plane" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </div>
    </div>
  </div>

  <!-- Force redirect-based auth in capture phase (for in-app browsers / popup-block) -->
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithRedirect, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-mqfAKi-qWowUgJXph-Z7qn9KQX31CbE",
      authDomain: "flight-logbook-50b3a.firebaseapp.com",
      projectId: "flight-logbook-50b3a",
      storageBucket: "flight-logbook-50b3a.appspot.com",
      messagingSenderId: "1022124291344"
    };

    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app); auth.useDeviceLanguage();
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ prompt: 'select_account' });

    const showLoader = (flag)=>{ document.getElementById('pageLoader')?.classList.toggle('show', !!flag); };

    const g = document.getElementById('googleBtn');
    g?.addEventListener('click', async (e)=>{
      e.preventDefault(); e.stopImmediatePropagation();
      try{ showLoader(true); await signInWithRedirect(auth, provider); }
      catch(err){ console.error(err); showLoader(false); }
    }, true);

    const gu = document.getElementById('guestBtn');
    gu?.addEventListener('click', async (e)=>{
      e.preventDefault(); e.stopImmediatePropagation();
      try{ showLoader(true); await signInAnonymously(auth); }
      catch(err){ console.error(err); showLoader(false); }
    }, true);
  </script>
</body>
</html>