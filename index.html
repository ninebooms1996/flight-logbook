<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FLIGHT‑LOGBOOK — Sign in & App (Single File)</title>
  <meta name="description" content="Single-file Flight Logbook: sign-in + flight form in one HTML page using Firebase Auth." />
  <style>
    :root{
      --bg1:#0f172a; --bg2:#1e293b; --text:#e5e7eb; --muted:#9aa4b2;
      --card:#0b1223bf; --accent:#6366f1; --accent2:#22d3ee; --ok:#16a34a;
      --topbar-h:72px; --ticker-h:28px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, #1f2937 0%, transparent 50%),
                  radial-gradient(900px 600px at 120% 10%, #0ea5e9 0%, transparent 40%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      padding-top: calc(var(--topbar-h) + var(--ticker-h));
    }
    /* Topbar + ticker (no left brand) */
    .topbar{ position:fixed; inset:0 0 auto 0; height:var(--topbar-h); z-index:40; backdrop-filter:saturate(140%) blur(8px); background:linear-gradient(180deg, #0b1223e6, #0b122399); border-bottom:1px solid #1f2937; }
    .topwrap{ max-width:1200px; margin:0 auto; height:100%; display:flex; align-items:center; justify-content:flex-start; padding:0 18px; position:relative; }
    .ticker{ position:absolute; left:0; right:0; bottom:6px; height:var(--ticker-h); overflow:hidden; pointer-events:none; }
    .track{ display:inline-block; white-space:nowrap; opacity:.23; font-weight:800; font-size:12px; letter-spacing:.08em; animation:marquee 38s linear infinite; }
    .item{ margin:0 22px; }
    @keyframes marquee{ 0%{ transform:translateX(0)} 100%{ transform:translateX(-50%) } }

    .wrap{ width:min(1100px, 94vw); margin:32px auto; padding:12px; display:grid; place-items:center; }
    .card{ position:relative; border:1px solid #1f2937; border-radius:24px; padding:24px; background:linear-gradient(180deg, #0b1223cc, #0b122380); backdrop-filter: blur(10px); box-shadow:0 20px 60px rgb(0 0 0 / 45%); }
    h1{ margin:0 0 10px; font-size:clamp(24px, 4vw, 36px); font-weight:800; letter-spacing:.3px; display:flex; align-items:center; gap:10px; }
    .logo{ width:54px; height:54px; border-radius:14px; display:grid; place-items:center; background:linear-gradient(135deg, #4f46e5, #22d3ee); box-shadow:inset 0 0 20px #ffffff22; }
    .logo svg{ width:28px; height:28px; color:white; }
    .tag{ color:var(--muted) }

    /* Sign-in panel */
    .panel{ border:1px solid #1f2937; border-radius:18px; padding:20px; background:#0b122355; width:min(560px, 92vw); margin:18px auto 0; }
    .panel h2{ margin:0 0 6px 0; font-size:18px; color:#c7d2fe; font-weight:700; }
    .panel p{ margin:0; color:var(--muted); }
    .actions{ display:flex; flex-direction:column; gap:12px; margin-top:18px; }
    button{ appearance:none; border:none; cursor:pointer; font-weight:700; font-size:16px;
      padding:14px 16px; border-radius:14px; width:100%; transition: transform .05s ease, box-shadow .2s ease, background .2s ease; display:flex; align-items:center; justify-content:center; gap:10px; }
    button:active{ transform: translateY(1px); }
    .btn-google{ background:#111827; color:#e5e7eb; border:1px solid #334155; }
    .btn-google:hover{ box-shadow:0 10px 30px #1f293733; }
    .btn-guest{ background:linear-gradient(90deg, #0ea5e9, #6366f1); color:white; }
    .btn-guest:hover{ box-shadow:0 10px 30px #0ea5e955; }

    /* App form */
    .grid{ display:grid; gap:16px; grid-template-columns: 1fr; margin-top:18px; }
    @media (min-width:900px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .field{ margin-bottom:12px; }
    .field label{ display:block; font-size:14px; color:#cbd5e1; margin-bottom:6px; }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    input, select{ width:100%; padding:12px 12px; border-radius:12px; border:1px solid #334155; background:#0f172a; color:#e5e7eb; outline:none; }
    input:focus, select:focus{ border-color:#64748b; }
    .actions-row{ grid-column:1 / -1; display:flex; gap:10px; }
    .btn{ appearance:none; border:none; cursor:pointer; padding:14px 16px; border-radius:14px; font-weight:800; }
    .btn-primary{ background:linear-gradient(90deg, #22c55e, #16a34a); color:white; }
    .btn-secondary{ background:#111827; color:#e5e7eb; border:1px solid #334155; }

    .toast{ position:fixed; right:16px; bottom:16px; padding:12px 14px; border-radius:12px; background:#111827; border:1px solid #374151; color:#e5e7eb; box-shadow:0 10px 30px #00000040; opacity:0; transform: translateY(6px); transition: all .2s ease; }
    .toast.show{ opacity:1; transform: translateY(0); }

    /* Loader overlay */
    .page-loader{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; background:radial-gradient(600px 360px at 30% 10%, #1f2937aa 0%, transparent 60%), rgba(2,6,23,.72); backdrop-filter: blur(6px); }
    .page-loader.show{ display:flex; }
    .loader-card{ width:min(420px,92vw); border:1px solid #1f2937; border-radius:16px; background:#0b1223cc; padding:18px; box-shadow:0 20px 60px #0008; }
    .loader-row{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .loader-logo{ width:46px; height:46px; border-radius:12px; display:grid; place-items:center; background:linear-gradient(135deg,#4f46e5,#22d3ee); box-shadow:inset 0 0 18px #ffffff22; }
    .loader-logo svg{ width:24px; height:24px; color:white; }
    .tube{ position:relative; height:12px; border-radius:999px; overflow:hidden; background:#0f172a; border:1px solid #334155; }
    .tube .fill{ position:absolute; inset:0 auto 0 0; width:100%; transform:translateX(-100%); background:linear-gradient(90deg,#22d3ee,#6366f1,#22c55e); animation:fillRun 2.2s ease-in-out infinite; }
    .tube .plane{ position:absolute; top:-14px; left:0; width:32px; height:32px; animation:planeRun 2.2s ease-in-out infinite; }
    @keyframes fillRun{ 0%{ transform:translateX(-100%) } 100%{ transform:translateX(0) } }
    @keyframes planeRun{ 0%{ transform:translateX(0) } 100%{ transform:translateX(calc(100% - 32px)) } }
    .hidden{ display:none !important; }
  </style>
</head>
<body>
  <!-- Topbar (ticker only) -->
  <header class="topbar" role="navigation" aria-label="Topbar">
    <div class="topwrap">
      <div class="ticker" aria-hidden="true">
        <div class="track">
          <span class="item">BKK — Suvarnabhumi</span>
          <span class="item">DMK — Don Mueang</span>
          <span class="item">CNX — Chiang Mai</span>
          <span class="item">HKT — Phuket</span>
          <span class="item">KBV — Krabi</span>
          <span class="item">URT — Surat Thani</span>
          <span class="item">USM — Samui</span>
          <span class="item">CEI — Chiang Rai</span>
          <span class="item">HDY — Hat Yai</span>
          <span class="item">UTH — Udon Thani</span>
          <span class="item">KKC — Khon Kaen</span>
          <span class="item">UBP — Ubon Ratchathani</span>
          <span class="item">THS — Sukhothai</span>
          <span class="item">TDX — Trat</span>
          <span class="item">HHQ — Hua Hin</span>
          <span class="item">BFV — Buriram</span>
          <span class="item">LPT — Lampang</span>
          <span class="item">NST — Nakhon Si Thammarat</span>
        </div>
        <div class="track" aria-hidden="true">
          <span class="item">BKK — Suvarnabhumi</span>
          <span class="item">DMK — Don Mueang</span>
          <span class="item">CNX — Chiang Mai</span>
          <span class="item">HKT — Phuket</span>
          <span class="item">KBV — Krabi</span>
          <span class="item">URT — Surat Thani</span>
          <span class="item">USM — Samui</span>
          <span class="item">CEI — Chiang Rai</span>
          <span class="item">HDY — Hat Yai</span>
          <span class="item">UTH — Udon Thani</span>
          <span class="item">KKC — Khon Kaen</span>
          <span class="item">UBP — Ubon Ratchathani</span>
          <span class="item">THS — Sukhothai</span>
          <span class="item">TDX — Trat</span>
          <span class="item">HHQ — Hua Hin</span>
          <span class="item">BFV — Buriram</span>
          <span class="item">LPT — Lampang</span>
          <span class="item">NST — Nakhon Si Thammarat</span>
        </div>
      </div>
    </div>
  </header>

  <!-- SIGN-IN VIEW -->
  <section id="signedOutView" class="wrap">
    <div class="card" style="width:min(980px, 92vw)">
      <div class="brand" style="display:flex; align-items:center; gap:14px; margin-bottom:6px;">
        <div class="logo" aria-hidden="true">
          <!-- Paper airplane icon -->
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </div>
        <div>
          <h1>FLIGHT‑LOGBOOK</h1>
          <div class="tag">ล็อกอินเพื่อเริ่มใช้งาน — Google หรือ Guest (ไม่ต้องสมัคร)</div>
        </div>
      </div>

      <div class="panel">
        <h2>เข้าสู่ระบบ</h2>
        <p>บันทึกชั่วโมงบินของคุณอย่างง่าย รวดเร็ว และปลอดภัย</p>
        <div class="actions">
          <button id="googleBtn" class="btn-google" type="button" aria-label="Sign in with Google">
            <!-- Google "G" logo -->
            <svg width="18" height="18" viewBox="0 0 48 48" aria-hidden="true"><path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.8 32.9 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.6 6.1 29.6 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.3-.1-2.7-.4-3.9z"/><path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.5 16.3 18.8 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.6 6.1 29.6 4 24 4 15.5 4 8.2 8.9 6.3 14.7z"/><path fill="#4CAF50" d="M24 44c5.2 0 10-2 13.6-5.2l-6.3-5.3C29.2 35.8 26.7 36.9 24 36c-5.3 0-9.8-3.1-11.6-7.6l-6.5 5C8 39 15.4 44 24 44z"/><path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.3 3.8-4.8 6.5-9.3 6.5-5.3 0-9.8-3.1-11.6-7.6l-6.5 5C8 39 15.4 44 24 44c8.9 0 20-6.5 20-20 0-1.3-.1-2.7-.4-3.9z"/></svg>
            Sign in with Google
          </button>
          <button id="guestBtn" class="btn-guest" type="button">เข้าสู่ระบบแบบ Guest</button>
        </div>
      </div>
    </div>
  </section>

  <!-- APP VIEW -->
  <section id="appView" class="wrap hidden">
    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div style="display:flex; align-items:center; gap:12px;">
          <div class="logo" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
          </div>
          <div>
            <h1>FLIGHT‑LOGBOOK</h1>
            <div class="tag">หน้าที่ 2 — บันทึกเที่ยวบิน</div>
          </div>
        </div>
        <button id="signOutBtn" class="btn btn-secondary" type="button">ออกจากระบบ</button>
      </div>

      <form id="flightForm" class="grid" autocomplete="off">
        <div class="panel">
          <h2>ข้อมูลเที่ยวบิน (Flight Information)</h2>
          <div class="field">
            <label for="flightDateTime">วันที่และเวลาที่ทำการบิน</label>
            <input id="flightDateTime" type="datetime-local" required />
          </div>
          <div class="row">
            <div class="field">
              <label for="flightNumber">หมายเลขเที่ยวบิน (Flight Number)</label>
              <input id="flightNumber" type="text" placeholder="เช่น TG102, FD1234" required />
            </div>
            <div class="field">
              <label for="airline">สายการบิน</label>
              <input id="airline" type="text" placeholder="เช่น Thai Airways" required />
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label for="origin">ต้นทาง (Origin)</label>
              <input id="origin" type="text" placeholder="เช่น BKK — Suvarnabhumi" required />
            </div>
            <div class="field">
              <label for="destination">ปลายทาง (Destination)</label>
              <input id="destination" type="text" placeholder="เช่น CNX — Chiang Mai" required />
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>ข้อมูลเครื่องบิน (Aircraft Information)</h2>
          <div class="field">
            <label for="aircraftModel">รุ่นของเครื่องบิน (Aircraft Model)</label>
            <input id="aircraftModel" type="text" placeholder="เช่น A320, B737-800" required />
          </div>
          <div class="field">
            <label for="registration">เครื่องหมายทะเบียน (Registration Number)</label>
            <input id="registration" type="text" placeholder="เช่น HS-TJA" required />
          </div>
        </div>

        <div class="actions-row">
          <button class="btn btn-primary" type="submit">บันทึกเที่ยวบิน</button>
          <button class="btn btn-secondary" type="reset">ล้างฟอร์ม</button>
        </div>
      </form>
    </div>
  </section>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Loader overlay -->
  <div id="pageLoader" class="page-loader" role="status" aria-live="polite" aria-label="กำลังโหลด">
    <div class="loader-card">
      <div class="loader-row">
        <div class="loader-logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </div>
        <div>
          <div style="font-weight:800; letter-spacing:.3px">กำลังเปลี่ยนหน้า…</div>
          <div style="color:#9aa4b2; font-size:13px">โปรดรอสักครู่</div>
        </div>
      </div>
      <div class="tube">
        <div class="fill"></div>
        <svg class="plane" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithRedirect, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // ---- Firebase Config (ของคุณ) ----
    const firebaseConfig = {
      apiKey: "AIzaSyB-mqfAKi-qWowUgJXph-Z7qn9KQX31CbE",
      authDomain: "flight-logbook-50b3a.firebaseapp.com",
      projectId: "flight-logbook-50b3a",
      storageBucket: "flight-logbook-50b3a.appspot.com",
      messagingSenderId: "1022124291344"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app); auth.useDeviceLanguage();
    const provider = new GoogleAuthProvider(); provider.setCustomParameters({ prompt:'select_account' });

    // ---- Helpers ----
    const qs = (s)=>document.querySelector(s);
    const toastEl = qs('#toast');
    const toast = (msg)=>{ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 2400); };
    const showLoader = (flag)=>{ document.getElementById('pageLoader')?.classList.toggle('show', !!flag); };

    const signedOutView = qs('#signedOutView');
    const appView = qs('#appView');

    // Start with loader until auth resolves
    showLoader(true);
    onAuthStateChanged(auth, (user)=>{
      showLoader(false);
      if(user){
        // show app
        signedOutView.classList.add('hidden');
        appView.classList.remove('hidden');
      }else{
        // show sign-in
        appView.classList.add('hidden');
        signedOutView.classList.remove('hidden');
      }
    });

    // ---- Sign in / out ----
    qs('#googleBtn')?.addEventListener('click', async ()=>{
      try{ showLoader(true); await signInWithRedirect(auth, provider); }
      catch(err){ console.error(err); showLoader(false); toast('ล็อกอินไม่สำเร็จ'); }
    });
    qs('#guestBtn')?.addEventListener('click', async ()=>{
      try{ showLoader(true); await signInAnonymously(auth); }
      catch(err){ console.error(err); showLoader(false); toast('ไม่สามารถเข้าสู่ระบบแบบ Guest ได้'); }
    });
    qs('#signOutBtn')?.addEventListener('click', async ()=>{
      try{ await signOut(auth); toast('ออกจากระบบแล้ว'); }
      catch(err){ console.error(err); toast('ออกจากระบบไม่ได้'); }
    });

    // ---- Form: save to localStorage (ชั่วคราว) ----
    const form = qs('#flightForm');
    form?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = {
        dateTime: qs('#flightDateTime').value,
        flightNumber: qs('#flightNumber').value.trim(),
        airline: qs('#airline').value.trim(),
        origin: qs('#origin').value.trim(),
        destination: qs('#destination').value.trim(),
        aircraftModel: qs('#aircraftModel').value.trim(),
        registration: qs('#registration').value.trim()
      };
      try{
        const key = 'flb_entries';
        const all = JSON.parse(localStorage.getItem(key) || '[]');
        all.push({ ...data, createdAt: Date.now() });
        localStorage.setItem(key, JSON.stringify(all));
        toast('บันทึกเที่ยวบินแล้ว');
        form.reset();
      }catch(err){ console.error(err); toast('บันทึกไม่สำเร็จ'); }
    });
  </script>
</body>
</html>
